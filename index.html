<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VPS Management</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
    header { background: #007bff; color: white; padding: 15px; text-align: center; }
    main { padding: 20px; max-width: 800px; margin: auto; }
    .card { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.15); }
    input, button { padding: 10px; margin: 8px 0; width: 100%; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; }
    button { background: #007bff; color: white; cursor: pointer; }
    button:hover { background: #0056b3; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
    th { background: #007bff; color: white; }
    #result { margin-top: 10px; font-weight: bold; color: green; }
  </style>
</head>
<body>
  <header>
    <h1>🚀 VPS Management</h1>
  </header>

  <main>
    <div class="card">
      <h2>Create VPS</h2>
      <input type="text" id="token" placeholder="Enter your GitHub Token">
      <button onclick="createVPS()">Create VPS</button>
      <p id="result"></p>
    </div>

    <div class="card">
      <h2>Users</h2>
      <button onclick="loadUsers()">Refresh Users</button>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Repo</th>
            <th>Status</th>
            <th>Remote Link</th>
          </tr>
        </thead>
        <tbody id="userTable"></tbody>
      </table>
    </div>
  </main>

<script>
  // 🔥 API backend của bạn (cố định)
  const API_BASE = "https://vps-1z6a.onrender.com";

  async function createVPS() {
    const token = document.getElementById("token").value;
    if (!token) {
      alert("Please enter a GitHub token!");
      return;
    }
    try {
      let res = await fetch(`${API_BASE}/api`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ github_token: token })
      });
      let data = await res.json();
      document.getElementById("result").innerText = 
        data.remote_link ? `✅ Created: ${data.remote_link}` : `❌ Error: ${JSON.stringify(data)}`;
    } catch (err) {
      console.error(err);
      alert("Failed to call API!");
    }
  }

  async function loadUsers() {
    try {
      let res = await fetch(`${API_BASE}/vpsuser`);
      let data = await res.json();
      const tbody = document.getElementById("userTable");
      tbody.innerHTML = "";
      if (data.users && data.users.length > 0) {
        data.users.forEach((u, i) => {
          let row = `<tr>
            <td>${i+1}</td>
            <td>${u.repo || "-"}</td>
            <td>${u.status || "-"}</td>
            <td><a href="${u.remote_link}" target="_blank">${u.remote_link || "-"}</a></td>
          </tr>`;
          tbody.innerHTML += row;
        });
      } else {
        tbody.innerHTML = `<tr><td colspan="4">No users found</td></tr>`;
      }
    } catch (err) {
      console.error(err);
      alert("Failed to load users!");
    }
  }
</script>
</body>
</html>
